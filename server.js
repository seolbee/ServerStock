const {getStock, getKOS} = require('./crollStock');
const cron = require('node-cron');
const {pool} = require('./DB');
let stock_codes = ['098120', '131100', '009520', '095570', '006840', '282330', '027410', '138930', '001465', '001460', '001045', '00104K', '001040', '011155', '011150', '058820', '000590', '012030', '016610', '005830', '000995', '000990', '139130', '001530', '000215', '001880', '000210', '37550K', '375500', '155660', '069730', '017940', '365550', '007700', '078935', '006360', '078930', '012630', '294870', '003560', '175330', '234080', '001065', '001067', '001060', '096760', '105560', '024120', '009070', '044180', '016385', '016380', '001390', '001940', '025000', '092230', '000040', '093050', '003555', '034220', '003550', '001120', '051905', '051900', '032640', '011070', '066575', '066570', '051915', '051910', '079550', '010120', '000680', '006260', '023150', '035420', '181710', '338100', '034310', '008260', '004255', '004250', '010060', '010955', '010950', '950110', '101060', '005090', '002360', '009160', '123700', '025530', '03473K', '011790', '018670', '001745', '001740', '210980', '034730', '096775', '096770', '001515', '001510', '28513K', '285130', '017670', '064960', '100840', '003570', '036530', '005610', '011810', '077970', '071970', '084870', '002710', '024070', '079940', '078890', '000500', '192410', '000860', '217730', '114190', '035250', '094480', '011420', '063080', '044480', '039240', '053950', '223310', '002100', '009450', '267290', '012320', '011040', '000050', '214390', '012610', '009140', '024910', '013580', '012205', '012200', '002140', '198440', '049720', '010130', '002240', '014570', '348150', '098460', '038530', '215000', '121440', '183410', '076340', '009290', '014200', '017040', '017900', '037710', '026910', '090150', '355150', '331520', '030610', '339770', '329050', '053270', '007690', '005320', '066620', '001140', '043650', '006050', '060480', '078130', '307750', '002720', '243870', '114090', '900290', '204020', '083420', '186230', '014530', '083450', '900070', '204620', '019660', '014285', '014280', '053260', '008870', '045890', '001570', '002995', '002990', '011785', '011780', '214330', '001210', '073240', '036190', '049080', '035460', '092440', '000270', '013700', '308100', '004545', '004540', '187790', '286750', '151910', '121600', '247660', '039860', '091970', '244880', '288490', '051490', '190510', '242040', '089600', '293580', '257990', '138610', '130580', '036800', '030190', '267320', '001260', '008355', '008350', '004270', '003925', '003920', '025860', '111710', '091590', '168330', '094860', '253590', '212560', '095660', '042420', '950220', '311390', '085910', '092730', '290660', '306620', '153460', '007390', '086220', '033640', '330860', '005725', '005720', '002355', '002350', '089140', '065170', '003580', '137940', '160550', '348210', '041140', '217270', '225570', '251270', '317860', '104620', '090355', '090350', '000325', '000320', '194700', '285490', '229500', '278650', '144510', '006280', '031390', '142280', '234690', '005257', '005250', '065560', '004370', '072710', '154030', '054050', '040160', '069140', '126870', '060260', '012340', '214870', '270870', '144960', '900100', '085670', '119860', '064260', '093640', '039560', '058730', '023590', '032190', '323350', '068240', '086080', '271850', '343090', '019680', '019685', '006370', '00806K', '008060', '353200', '35320K', '178600', '000490', '020400', '008830', '048470', '008110', '004780', '005750', '017650', '006570', '007720', '317850', '290670', '078140', '001685', '001680', '084695', '084690', '036480', '128820', '117580', '025440', '027830', '104040', '016710', '332290', '336570', '369370', '020180', '003545', '003547', '003540', '045390', '009190', '108380', '006580', '014160', '047040', '009320', '042660', '003090', '069620', '007680', '000430', '048910', '005710', '006345', '006340', '003220', '024890', '290380', '002880', '290120', '000300', '120240', '003310', '114920', '078600', '015230', '012800', '096350', '140520', '131220', '010170', '060900', '054670', '001070', '023910', '006650', '001440', '084010', '001795', '001790', '001130', '003495', '003490', '005880', '003830', '016090', '069460', '021040', '021045', '067080', '161570', '298540', '192080', '073570', '299170', '035290', '052300', '089230', '012510', '302920', '213420', '317330', '077360', '004835', '004830', '090410', '024900', '263600', '194480', '348840', '263800', '199150', '206560', '261200', '145720', '227420', '067990', '002150', '006620', '005160', '075970', '100130', '001230', '086450', '004140', '099410', '007590', '005965', '005960', '026960', '002210', '102260', '033500', '005190', '025950', '000640', '170900', '088130', '028100', '282690', '041930', '001525', '001527', '001529', '084670', '002900', '001520', '082640', '060380', '079960', '008970', '228340', '092780', '088910', '094170', '049770', '013120', '018500', '006040', '030720', '014825', '014820', '163560', '109860', '032960', '004890', '002690', '023790', '005290', '025900', '000020', '000155', '000157', '241560', '000150', '042670', '034020', '33626K', '33626L', '336260', '016740', '073190', '176750', '030350', '203650', '223250', '060570', '192650', '217620', '187870', '367340', '367360', '066670', '024090', '003160', '092200', '110990', '004840', '263690', '214680', '263720', '241520', '109740', '033430', '131030', '196490', '066900', '127120', '092070', '068790', '134580', '039840', '013570', '210540', '104460', '079810', '227100', '113810', '043360', '197140', '106520', '068930', '033130', '105740', '263020', '290550', '007340', '187220', '026890', '163430', '131180', '317120', '042510', '232680', '300120', '050120', '171120', '069540', '285770', '347700', '214260', '115390', '200350', '171010', '084650', '217500', '092590', '033600', '141080', '060300', '038390', '294140', '228670', '228850', '281740', '277810', '179720', '215100', '090360', '238500', '108490', '900260', '067730', '071280', '032350', '330590', '000400', '023530', '004000', '286940', '280360', '00499K', '004990', '005305', '005300', '011170', '002270', '071840', '038060', '162120', '253610', '085370', '08537M', '060240', '058470', '039980', '019570', '016100', '012700', '302550', '029480', '277070', '042500', '219420', '027740', '195500', '222810', '305090', '147760', '169330', '038290', '204320', '001080', '267980', '005990', '127160', '093520', '141070', '088980', '100590', '067280', '072870', '215200', '133750', '235980', '200580', '041920', '233250', '014100', '236340', '054180', '086900', '078160', '065650', '138040', '008560', '000060', '021880', '140410', '241770', '090370', '059210', '327260', '058110', '096640', '017180', '257370', '009900', '267060', '012690', '005360', '080420', '080160', '204210', '100030', '087260', '101330', '012860', '348030', '250060', '033200', '009680', '118990', '006920', '001810', '009200', '009580', '322970', '033920', '008420', '279600', '028040', '095500', '025560', '218150', '007120', '353490', '328380', '333430', '357250', '094800', '100790', '085620', '006805', '00680K', '006800', '208890', '049950', '213090', '207760', '225850', '002840', '268280', '107590', '134380', '003650', '059090', '214610', '201490', '950190', '214180', '155900', '206640', '018700', '035620', '064520', '053030', '301300', '064550', '314930', '208710', '142760', '086820', '038460', '281310', '266470', '216400', '086040', '199290', '032980', '222160', '043150', '323990', '003610', '267790', '001340', '046310', '035150', '036620', '066410', '002410', '206400', '019010', '177350', '299910', '007210', '225530', '250000', '002760', '003850', '006910', '000890', '226340', '206950', '008470', '003000', '001275', '001270', '026940', '014470', '015350', '011390', '005030', '338220', '100120', '337930', '064480', '288330', '251630', '018290', '263920', '033560', '126340', '121800', '148140', '082800', '318410', '002070', '100220', '200780', '141000', '090460', '083650', '215050', '086670', '335890', '138580', '082920', '054220', '042370', '030790', '032850', '148780', '238200', '093190', '065450', '210120', '352820', '005180', '072950', '266170', '143240', '003960', '008040', '007160', '014710', '006090', '100090', '122350', '014970', '018310', '053700', '009620', '023600', '111870', '001470', '006405', '006400', '006660', '291230', '02826K', '028260', '207940', '032830', '018260', '028050', '009155', '009150', '005935', '005930', '001360', '010145', '010140', '016360', '068290', '029780', '000815', '000810', '006110', '009300', '145995', '145990', '003230', '225190', '002170', '272550', '000075', '000070', '060310', '002810', '054540', '065570', '005680', '003720', '023000', '004380', '002450', '032280', '002290', '004440', '000520', '009770', '037460', '032750', '054090', '005500', '000250', '004690', '024950', '038500', '017480', '010960', '046390', '004450', '009470', '011230', '001820', '000390', '027580', '038540', '307870', '329560', '101000', '001290', '041650', '091580', '263810', '089980', '042940', '042600', '075180', '263540', '007540', '248170', '294630', '038070', '006730', '079650', '100660', '007860', '200880', '019770', '017390', '043710', '092190', '046890', '004415', '004410', '063170', '027040', '018680', '021050', '093920', '189860', '178320', '122690', '140070', '011370', '065710', '008490', '035890', '357550', '003100', '123420', '007610', '067370', '171090', '136490', '086710', '002820', '014620', '037350', '014915', '014910', '003080', '004985', '004980', '011300', '081580', '045300', '015750', '000180', '080470', '043260', '148150', '002420', '053060', '017510', '214310', '004365', '004360', '004490', '011560', '001430', '306200', '003030', '019440', '058650', '013000', '100700', '234100', '024830', '091090', '021820', '067830', '033530', '258830', '036630', '039310', '075580', '067770', '053450', '234340', '027970', '145210', '252500', '347000', '308170', '051980', '012600', '331920', '049180', '299660', '268600', '108860', '208370', '258250', '068270', '068760', '091990', '290690', '053110', '950200', '032680', '032685', '258790', '066910', '043100', '33637K',
                    '33637L', '336370', '154040', '248070', '035610', '357780', '036830', '304100', '004430', '086980', '050960', '017550', '084180', '253840', '058530', '236200', '317770', '094840', '192440', '099440', '033790', '159910', '158310', '115570', '258540', '204630', '253450', '013810', '039670', '049830', '020710', '033170', '260870', '048870', '025320', '134790', '269620', '131090', '232830', '139050', '016590', '290520', '029530', '004970', '001000', '025870', '215600', '065350', '011930', '005390', '034300', '004170', '035510', '031430', '031440', '006880', '002800', '005800', '001725', '001720', '323280', '344050', '009275', '009270', '017000', '002700', '012790', '138070', '226330', '019175', '019170', '002870', '055550', '293940', '333050', '366330', '001770', '056700', '187270', '004080', '243840', '108320', '222800', '036710', '160980', '356890', '217330', '102280', '003410', '003620', '010280', '004770', '217320', '208640', '222420', '037760', '136510', '099320', '015540', '049960', '050890', '066790', '222080', '004920', '236030', '103660', '245450', '023460', '264660', '352700', '065770', '297090', '083660', '112610', '286000', '115530', '225330', '056000', '115480', '189330', '000120', '079160', '035760', '097955', '097950', '051500', '096530', '900120', '101240', '060590', '260930', '013990', '123860', '025980', '008700', '050320', '058220', '125210', '002795', '00279K', '002790', '090435', '090430', '052710', '074430', '092040', '083930', '149950', '036010', '002030', '183190', '002310', '050860', '246720', '067390', '127710', '267850', '020560', '227610', '143160', '054800', '332370', '122900', '339950', '335870', '351340', '351320', '373200', '099190', '289010', '214430', '040910', '068940', '052860', '010780', '095340', '069920', '038880', '123010', '307180', '101390', '052220', '090740', '226350', '078860', '114810', '031310', '185490', '059100', '149010', '262840', '175250', '052460', '119830', '052770', '124500', '099520', '084850', '223220', '027360', '032080', '013310', '059120', '158430', '149300', '067160', '001540', '053800', '251280', '065660', '297570', '001780', '260660', '131370', '140670', '096610', '218410', '061040', '148250', '347860', '196170', '123750', '085810', '117670', '291650', '293780', '267810', '018250', '161000', '196300', '310200', '179530', '205500', '052790', '131400', '290740', '238090', '092600', '129890', '174900', '255440', '030960', '102120', '238120', '224810', '019990', '011090', '041440', '270660', '038680', '217480', '121890', '099220', '097780', '289080', '019550', '034120', '046140', '042110', '036120', '298060', '065420', '270210', '103230', '260970', '900080', '101490', '950180', '095910', '275630', '031330', '060540', '056190', '036540', '080000', '091340', '005850', '246250', '063440', '299670', '041510', '048550', '007820', '109610', '012750', '306040', '080440', '217910', '004060', '016250', '049470', '184230', '224880', '040610', '255220', '001380', '036490', '006125', '006120', '068400', '302440', '326030', '224020', '307070', '337450', '340350', '000660', '096630', '069510', '041910', '234300', '039440', '098660', '052020', '237690', '050760', '288620', '317830', '058610', '043340', '023960', '298690', '054630', '200710', '096690', '078520', '298380', '203400', '195990', '003800', '322190', '088800', '241840', '138360', '039230', '312610', '015260', '234070', '140910', '102210', '039570', '089470', '078150', '072990', '036640', '082740', '044990', '176440', '028300', '067630', '047920', '043220', '239610', '353070', '353060', '011200', '044780', '071670', '045660', '224110', '230980', '021080', '089530', '200470', '073070', '207490', '262260', '003060', '007460', '109960', '244920', '265520', '054620', '211270', '089970', '230240', '064510', '230360', '038870', '128540', '086520', '247540', '038110', '073540', '064850', '064090', '036810', '173940', '083500', '054940', '950130', '205100', '070300', '092870', '317870', '067570', '236810', '140610', '333620', '101400', '036570', '217820', '138250', '031860', '238170', '224760', '310840', '353190', '359090', '365590', '104200', '060250', '005945', '005940', '265740', '053290', '354200', '093510', '208860', '183490', '085310', '182400', '009810', '069410', '227950', '198080', '048830', '096870', '276240', '900140', '061970', '138690', '290650', '066970', '156100', '229640', '311060', '073110', '083310', '297890', '108670', '108675', '037560', '037950', '170920', '058630', '058970', '019590', '097520', '179290', '225860', '009780', '123040', '323230', '032790', '033160', '347890', '033310', '259630', '065150', '219550', '115960', '060850', '014440', '007530', '143540', '111770', '009970', '003520', '000670', '036560', '006740', '012280', '265560', '012160', '036000', '250930', '053280', '015360', '122640', '900300', '045060', '080520', '007310', '039830', '322310', '046120', '014940', '002630', '065500', '271560', '001800', '010470', '053980', '052420', '241790', '329020', '039200', '031510', '048260', '138080', '080580', '067170', '173130', '049480', '309930', '078590', '244460', '226950', '057540', '082210', '109080', '153710', '051390', '321820', '057030', '122990', '232140', '067900', '155650', '251370', '066430', '193250', '273060', '019210', '122870', '037270', '040300', '332570', '079000', '114630', '316140', '033660', '032820', '041190', '115440', '004720', '118000', '046970', '082850', '215360', '072470', '073560', '153490', '037400', '010050', '101170', '006980', '066590', '017370', '103840', '046940', '215380', '065680', '105840', '018620', '010400', '049800', '016880', '095720', '005820', '307280', '053080', '032940', '104830', '240810', '014190', '074600', '030530', '012620', '216280', '122830', '008370', '008290', '101160', '095270', '010600', '065950', '076080', '196700', '069080', '053580', '071460', '044340', '330350', '348350', '112040', '065370', '140660', '038620', '299900', '036090', '136540', '320000', '097800', '192390', '313760', '008600', '900340', '014830', '036200', '018000', '047400', '000910', '203450', '011330', '077500', '011320', '086390', '241690', '142210', '121060', '048430', '206650', '089850', '032620', '264450', '078070', '002920', '024800', '000700', '054930', '038340', '069330', '049520', '313750', '336060', '340360', '367460', '367480', '003475', '003470', '056090', '011690', '263770', '337840', '072130', '000225', '000227', '000220', '340930', '023410', '321260', '331380', '373340', '056080', '084370', '001200', '178780', '221800', '179900', '263050', '000105', '000100', '003465', '003460', '191410', '008730', '072770', '008250', '039020', '025820', '060230', '067920', '044960', '302430', '279060', '214320', '073490', '086250', '215790', '344860', '246960', '088390', '272290', '053350', '258610', '336040', '215090', '041520', '264850', '054210', '164060', '065440', '088260', '139480', '115610', '349720', '323210', '078020', '208850', '080010', '086890', '007660', '005950', '015020', '047560', '900110', '270020', '067010', '093230', '341310', '052190', '226360', '101360', '102710', '066980', '074610', '063760', '087730', '123570', '079190', '278990', '083470', '095190', '091120', '232530', '102460', '039030', '294090', '245620', '088290', '084680', '181340', '037370', '353810', '350520', '334890', '090850', '099750', '035810', '160600', '092130', '096040', '134060', '001840', '000760', '024810', '014990', '041830', '352940', '101140', '079950', '277410', '060150', '033230', '006490', '037330', '023800', '034590', '211050', '083640', '216050', '049070', '119610', '017250', '129260', '240340', '035080', '051370', '064290', '189300', '150840', '048530', '023810', '175140', '115310', '039290', '071200', '101930', '249420', '000230', '013360', '003120', '068330', '003200', '007110', '058450', '007575', '007570', '008500', '019540', '081000', '020760', '020150', '103590', '094820', '015860', '226320', '950140', '049550', '254120', '221610', '043910', '234920', '289220', '317400', '033240', '174880', '049630', '000950', '120780', '110020', '208140', '022220', '040420', '045510', '065620', '217190', '095700', '072520', '122310', '361390', '066830', '225220', '123330', '159580', '147830', '033100', '079370', '067290', '054950', '090470', '287410', '137950', '033320', '348950', '204270', '194370', '026040', '126880', '322510', '033050', '094970', '035900', '058420', '025620', '036420', '089790', '950170', '030000', '052670', '271980', '001560', '199820', '023440', '038010', '002620', '080220', '006220', '089590', '216080', '229000', '082270', '064800', '041590', '044060', '004910', '004700', '001550', '000480', '120030', '034940', '101730', '067000', '018470', '002600', '063160', '185750', '001630', '033340', '036930', '185190', '158300', '086460', '226400', '070960', '084440', '187420', '189350', '023450', '002380', '044380', '239340', '024110', '072020', '000440', '228760', '314130', '013890', '043610', '263860', '303030', '036180', '208350', '114570', '299480', '051160', '001250', '007070', '053050', '028150', '130500', '119850', '270520', '065060', '204840', '013870', '071320', '135160', '111820', '010580', '035000', '115450', '219750', '088790', '018120', '109820', '086060', '036890', '003780', '007370', '010640', '100250', '051630', '272450', '011000', '250030', '002785', '002787', '002780', '233990', '085660', '900250', '009310', '094850', '004650', '311690', '278280', '000650', '140290', '096240', '013720', '066360', '033250', '047820', '094360', '016920', '284620', '293490', '035720', '042000', '006380', '317530', '071850', '180400', '050110', '109070', '900310', '078340', '307930', '263700', '327970', '214370', '221980', '900280', '043290', '001620', '024840', '317030', '323940', '330990', '342550', '192250', '009440', '029460', '112190', '021320', '344820', '036670', '115500', '119650', '281820', '089150', '025880', '093320', '044450', '073010', '060720', '105330', '058400', '272110', '039420', '083550', '032500', '122450', '052900', 
                    '225430', '092220', '046440', '035600', '151860', '145270', '030200', '030210', '060370', '053210', '058850', '058860', '033780', '036030', '064820', '347140', '256940', '024880', '114450', '042040', '054410', '274090', '217600', '089010', '220260', '052400', '033110', '046070', '047770', '078940', '080530', '224060', '357120', '078650', '104540', '027050', '290510', '007815', '00781K', '007810', '190650', '101670', '123410', '003690', '036690', '049430', '183300', '041960', '089890', '009730', '082660', '192820', '044820', '222040', '241710', '005070', '005420', '069110', '071950', '166480', '045970', '196450', '029960', '002025', '003075', '003070', '144620', '002020', '102940', '120115', '120110', '950160', '138490', '021240', '033290', '056360', '282880', '121850', '015710', '052330', '322780', '126600', '200130', '031820', '192400', '284740', '317690', '060280', '015590', '040350', '051780', '115180', '043090', '182360', '066310', '136660', '016600', '26490K', '264900', '005745', '005740', '215570', '043590', '114120', '110790', '083790', '045520', '036170', '214150', '352770', '237880', '139670', '020120', '311270', '039490', '012170', '054780', '219130', '180060', '065130', '014580', '015890', '006890', '023160', '003240', '011280', '053620', '004105', '004100', '116100', '009410', '009415', '044490', '124560', '001420', '007980', '191420', '073640', '182690', '066700', '095610', '131970', '055490', '308700', '089030', '258050', '054450', '091440', '078000', '200230', '214420', '215480', '051360', '045340', '108230', '079970', '199800', '105550', '026150', '322180', '117730', '033830', '057680', '064760', '246710', '340570', '277880', '131290', '246690', '317240', '019180', '356860', '062860', '36328K', '363280', '321550', '091810', '004870', '032540', '191600', '104480', '309900', '081150', '130740', '048770', '217880', '084730', '046210', '034230', '033540', '043200', '217950', '214450', '208340', '005690', '177830', '037070', '150900', '037030', '047310', '266870', '170790', '049120', '038950', '106240', '131760', '065690', '140860', '091700', '038160', '202960', '032800', '318010', '036580', '027710', '225590', '054300', '068050', '028670', '222110', '010820', '016800', '263750', '251970', '001020', '327610', '087010', '090080', '043370', '010770', '119500', '016670', '056730', '058430', '005490', '022100', '047050', '003670', '189690', '318020', '256630', '141020', '354230', '041020', '007630', '290720', '005670', '094940', '007330', '017810', '093380', '023900', '103140', '005810', '195440', '214270', '220100', '035200', '334970', '950210', '203690', '303360', '053610', '335810', '053160', '075130', '222670', '237820', '023770', '300080', '150440', '032580', '051380', '241820', '178920', '237750', '131390', '024850', '319660', '031980', '002230', '242350', '239890', '347740', '137400', '024940', '128660', '006140', '304840', '062970', '087600', '057880', '033180', '161580', '347770', '163730', '332710', '341160', '343510', '363260', '086790', '299030', '067310', '372290', '307160', '166090', '293480', '039130', '136480', '003380', '172580', '153360', '149980', '013030', '126700', '106080', '071090', '340120', '221840', '106190', '019490', '000087', '000080', '000145', '000140', '066130', '004590', '036460', '039340', '005430', '034950', '010040', '025540', '222980', '331660', '318000', '096300', '256840', '004090', '025550', '002200', '002960', '023890', '017890', '000240', '033270', '080720', '123890', '015760', '052690', '063570', '041460', '006200', '065530', '101680', '039740', '053300', '025770', '310870', '368770', '009540', '023350', '025890', '000970', '104700', '017960', '023760', '054040', '050540', '161890', '024720', '021650', '161390', '053590', '034830', '152550', '168490', '071055', '071050', '007280', '032300', '037230', '010100', '047810', '123690', '003350', '030520', '052600', '011500', '002390', '256150', '014790', '092460', '060980', '053690', '042700', '008930', '128940', '047080', '009240', '020000', '003680', '105630', '069640', '016450', '010420', '009180', '070590', '213500', '014680', '004710', '004150', '025750', '226440', '042520', '004960', '011700', '078350', '045100', '001755', '001750', '018880', '009420', '014130', '046110', '024740', '005860', '300720', '123840', '002220', '006390', '003300', '007770', '051600', '130660', '107640', '002320', '097230', '003480', '18064K', '180640', '005110', '079170', '009460', '086960', '054920', '002680', '066110', '000885', '00088K', '000880', '088350', '000370', '009835', '009830', '272210', '317320', '012450', '003535', '003530', '340440', '220630', '195870', '034810', '076610', '101530', '220180', '143210', '008800', '900270', '084990', '000725', '267270', '000720', '170030', '005440', '086280', '064350', '079430', '012330', '319400', '010620', '052260', '048410', '069960', '004565', '004560', '016790', '004310', '322000', '017800', '307950', '011210', '267260', '005385', '005387', '005389', '005380', '004020', '267250', '001500', '011760', '227840', '039010', '126560', '001450', '057050', '092300', '053660', '011080', '093240', '003010', '111110', '008775', '008770', '060560', '064240', '039610', '002460', '378850', '241590', '006060', '013520', '010690', '126640', '133820', '061250', '010660', '000850', '016580', '032560', '004800', '094280', '097870', '298040', '298050', '298020', '298000', '093370', '050090', '081660', '290270', '005870', '284420', '090710', '205470', '115160', '028080', '032860', '200670', '212310', '079980', '065510', '005010', '243070', '084110', '145020', '069260', '024060', '010240', '189980', '000545', '000547', '000540', '003280', '037440', '238490'];
let kos_codes = [];

async function getStock_codes(){
    let result = await pool.query("SELECT code FROM stock_kinds");
    stock_codes = result[0].map(x=> x.code);
}

async function getKOS_codes(){
    let result = await pool.query("SELECT code FROM stock_kos");
    kos_codes = result[0].map(x=> x.code);
}

async function crollStock(){
    let cnt = 100;
    let length = Math.ceil(stock_codes.length / cnt);
    let promise_arr = [];
    for(let i = 0; i < length; i++){
        let str = stock_codes.slice((i * cnt), (i + 1) * cnt).join(',');
        let result = JSON.parse(await getStock(str)).result;
        let json_arr = result.areas[0].datas;
        let sql_str = "INSERT INTO stock_price VALUES ?";
        let param_arr = json_arr.map((e) => [e.cd, e.nv, new Date(result.time)]);
        promise_arr.push(pool.query(sql_str, [param_arr]));
    }

    await Promise.all(promise_arr);
}

// async function crollKOS(){
//     for(let x of stock_codes){
//         let result = JSON.parse(await getKOS(x)).result;
//         let json = result.areas[0].datas[0];
//         await pool.query("INSERT INTO stock_kos_datas VALUES(?, ?, ?)", [json.cd, json.nv, new Date(result.time)]);
//     }
// }

cron.schedule('0 0 9-16 * * MON,TUE,WED,THU,FRI *', async () => {
    await crollStock();
});

// cron.schedule('0 * * * * *', async () => {
//     await crollStock();
// });

// console.log(stock_codes.length);

// crollStock();